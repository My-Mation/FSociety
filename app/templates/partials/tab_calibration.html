<!-- ===== CALIBRATION TAB (Strict UX Overhaul v6.0) ===== -->
<div id="calibration" class="tab-content active">

    <!-- Top Control Bar -->
    <div
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 15px;">
        <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #fff; letter-spacing: 0.05em;">
            CALIBRATION / START LISTENING
            <span class="mode-badge idle" id="cal-mode-badge"
                style="font-size: 10px; padding: 4px 8px; vertical-align: middle;">IDLE</span>
        </h3>
        <div class="status info" id="calibration-status"
            style="margin: 0; padding: 8px 16px; font-size: 12px; background: #2a2a2a; color: #888; border: 1px solid #333;">
            Click "Start Listening" on a machine to begin
        </div>
    </div>

    <!-- Machine Selection Grid -->
    <div class="machines-grid" id="calibration-machines" style="margin-bottom: 30px;">
        <!-- Generated by JS -->
    </div>

    <!-- MAIN DASHBOARD GRID (24 Cols) - CONTROL PANEL -->
    <div id="calibration-control-panel" class="grid-24" style="display:none;">

        <!-- ============================================ -->
        <!-- ROW 1: ACTIVE SESSION CONTROLS               -->
        <!-- ============================================ -->

        <!-- Active Machine & Timer (Col-12) -->
        <div class="tile col-12">
            <div class="tile-header">
                <span class="tile-title">ACTIVE TARGET</span>
                <span class="tile-title" style="color: #666;">SESSION STATUS</span>
            </div>
            <div class="tile-content" style="flex-direction: row; justify-content: space-between; align-items: center;">
                <div>
                    <div class="kpi-unit">LISTENING FOR</div>
                    <div class="kpi-value" id="cal-active-machine" style="color: #fdeb4d;">--</div>
                </div>
                <div style="text-align: right;">
                    <div class="kpi-value large" id="calibration-timer" style="color: #3b82f6;">0s</div>
                    <div class="kpi-unit">
                        <span id="cal-duration">0s / 60s</span>
                        <span style="margin-left: 10px; color: #fbbf24;" id="cal-time-remain">60s REMAINING</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls (Col-12) -->
        <div class="tile col-12">
            <div class="tile-header">
                <span class="tile-title">SESSION CONTROLS</span>
            </div>
            <div class="tile-content" style="flex-direction: row; align-items: center; gap: 15px;">
                <button id="calibration-stop" class="stop-btn" onclick="stopCalibration()"
                    style="flex: 1; height: 100%; display: flex; align-items: center; justify-content: center;">
                    STOP LISTENING
                </button>
                <button id="calibration-save" onclick="saveProfile()" disabled
                    style="flex: 1; height: 100%; background: #3b82f6; display: flex; align-items: center; justify-content: center;">
                    SAVE PROFILE
                </button>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ROW 2: AUDIO SUMMARY TABLE                   -->
        <!-- ============================================ -->
        <div class="tile col-10" style="height: 250px;">
            <div class="tile-header">
                <span class="tile-title">TABLE A - CALIBRATION AUDIO SUMMARY</span>
            </div>
            <div class="tile-content no-pad">
                <div class="dense-table-container">
                    <table class="dense-table">
                        <thead>
                            <tr>
                                <th>METRIC</th>
                                <th>VALUE</th>
                                <th>UNIT</th>
                                <th>STATUS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>AVG AMPLITUDE</td>
                                <td id="cal-avg-amp" style="color: #5a9bd5; font-weight: 700;">0.0</td>
                                <td>dB</td>
                                <td><span class="status-cell-green">OK</span></td>
                            </tr>
                            <tr>
                                <td>PEAK FREQUENCY</td>
                                <td><span id="cal-peak-freq">0</span></td>
                                <td>Hz</td>
                                <td><span class="status-cell-green">TRACKING</span></td>
                            </tr>
                            <tr>
                                <td>CURRENT AMP</td>
                                <td id="cal-current-amp">0.0</td>
                                <td>dB</td>
                                <td>--</td>
                            </tr>
                            <tr>
                                <td>CURRENT FREQ</td>
                                <td id="cal-current-freq">0.0 Hz</td>
                                <td>Hz</td>
                                <td>--</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ROW 2: SENSOR SNAPSHOT TABLE                 -->
        <!-- ============================================ -->
        <div class="tile col-14" style="height: 250px;">
            <div class="tile-header">
                <span class="tile-title">TABLE B - CALIBRATION SENSOR SNAPSHOT</span>
                <span class="tile-title" style="color: #666;">DATA COLLECTION PROGRESS</span>
            </div>
            <div class="tile-content no-pad">
                <div class="dense-table-container">
                    <table class="dense-table">
                        <thead>
                            <tr>
                                <th>SENSOR</th>
                                <th>SAMPLES COLLECTED</th>
                                <th>TARGET</th>
                                <th>PROGRESS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>AUDIO STREAM</td>
                                <td id="cal-frames" style="font-weight: 700; color: #fff;">0</td>
                                <td>AUTO</td>
                                <td style="width: 120px;">
                                    <div style="height: 6px; background: #333; border-radius: 2px; width: 100%;">
                                        <div id="cal-frames-progress"
                                            style="height: 100%; width: 0%; background: #3b82f6; border-radius: 2px;">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>VIBRATION</td>
                                <td id="cal-vib-count" style="font-weight: 700; color: #fff;">0</td>
                                <td>--</td>
                                <td>
                                    <div style="height: 6px; background: #333; border-radius: 2px; width: 100%;">
                                        <div id="cal-vib-progress"
                                            style="height: 100%; width: 0%; background: #eab308; border-radius: 2px;">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>GAS / AIR</td>
                                <td id="cal-gas-count" style="font-weight: 700; color: #fff;">0</td>
                                <td>--</td>
                                <td>
                                    <div style="height: 6px; background: #333; border-radius: 2px; width: 100%;">
                                        <div id="cal-gas-progress"
                                            style="height: 100%; width: 0%; background: #ef4444; border-radius: 2px;">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- WAVEFORM & GRAPHS CONTAINER -->
    <div id="calibration-waveform-container" class="grid-24" style="display:none; margin-top: 20px;">

        <!-- ROW A: WAVEFORM + AUDIO HISTORY -->

        <!-- Live Waveform (Col-12) -->
        <div class="tile col-12" style="height: 300px; border-color: #444;">
            <div class="tile-header">
                <span class="tile-title" style="color: #3b82f6;">LIVE AUDIO WAVEFORM</span>
                <span class="tile-title">OSCILLOSCOPE</span>
            </div>
            <div class="tile-content no-pad">
                <canvas id="calibration-canvas"></canvas>
            </div>
        </div>

        <!-- Audio History (Col-12) -->
        <div class="tile col-12" style="height: 300px; border-color: #444;">
            <div class="tile-header">
                <span class="tile-title" style="color: #3b82f6;">AUDIO LEVEL HISTORY (SESSION)</span>
                <span class="tile-title">AMPLITUDE vs TIME</span>
            </div>
            <div class="tile-content no-pad">
                <canvas id="calibration-audio-chart"></canvas>
            </div>
        </div>

        <!-- ROW B: SPECTRUM + VIBRATION HISTORY -->

        <!-- Spectrum (Col-12) -->
        <div class="tile col-12" style="height: 300px;">
            <div class="tile-header">
                <span class="tile-title">FREQUENCY SPECTRUM ANALYSIS</span>
                <span class="tile-title">Real-time FFT</span>
            </div>
            <div class="tile-content no-pad">
                <canvas id="calibration-spectrum" class="spectrum-chart"></canvas>
            </div>
        </div>

        <!-- Vibration History (Col-12) -->
        <div class="tile col-12" style="height: 300px;">
            <div class="tile-header">
                <span class="tile-title">VIBRATION HISTORY (RMS)</span>
                <span class="tile-title">ACCEL vs TIME</span>
            </div>
            <div class="tile-content no-pad">
                <canvas id="calibration-vibration-chart"></canvas>
            </div>
        </div>

        <div id="calibration-placeholder" class="tile col-24" style="display:none; height: 100px; text-align: center;">
            <div class="tile-content">
                <p style="color: #666; font-size: 14px;">No audio samples captured yet. Start listening to see live
                    data.
                </p>
            </div>
        </div>

    </div>

</div>