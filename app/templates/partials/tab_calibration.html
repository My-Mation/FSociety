<!-- ===== CALIBRATION TAB (Per-Machine Listening) ===== -->
<div id="calibration" class="tab-content active">
    <div class="status info" id="calibration-status">Click "Start Listening" on a machine to begin calibration
    </div>

    <h3>Start Listening â€“ Per Machine <span class="mode-badge idle" id="cal-mode-badge">IDLE</span></h3>
    <p style="color: #888; margin-bottom: 25px; font-size: 14px; font-weight: 400;">
        Each machine profile captures: Audio signature + Vibration pattern + Gas/air quality data
    </p>

    <!-- Machine Listen Buttons -->
    <div class="machines-grid" id="calibration-machines">
        <!-- Generated by JS -->
    </div>

    <!-- Calibration Control Panel -->
    <div class="control-panel" id="calibration-control-panel" style="display:none;">
        <h4 style="color: #5a9bd5; margin-bottom: 10px; font-weight: 600;">
            Listening for: <span id="cal-active-machine">--</span>
        </h4>

        <div class="info-row">
            <span class="info-label">Recording Duration:</span>
            <span class="info-value" id="cal-duration">0s / 60s</span>
        </div>

        <!-- Data Collection Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Audio Frames</div>
                <div class="stat-value" id="cal-frames">0</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cal-frames-progress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Vibration</div>
                <div class="stat-value" id="cal-vib-count">0</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cal-vib-progress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Gas Samples</div>
                <div class="stat-value" id="cal-gas-count">0</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cal-gas-progress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Amplitude</div>
                <div class="stat-value" id="cal-avg-amp">0.0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Peak Frequency</div>
                <div class="stat-value"><span id="cal-peak-freq">0</span><span class="stat-unit">Hz</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Current Amplitude</div>
                <div class="stat-value" id="cal-current-amp">0.0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Current Frequency</div>
                <div class="stat-value" id="cal-current-freq">0.0 Hz</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Time Remaining</div>
                <div class="stat-value" id="cal-time-remain">60s</div>
            </div>
        </div>

        <div class="timer" id="calibration-timer">0s</div>

        <div style="margin-top: 15px;">
            <button id="calibration-stop" class="stop-btn" onclick="stopCalibration()">Stop Listening</button>
            <button id="calibration-save" onclick="saveProfile()" disabled style="background: #3b82f6;">Save
                Profile</button>
        </div>
    </div>

    <!-- Waveform and Spectrum (shown when listening) -->
    <div id="calibration-waveform-container" style="display:none;">
        <h3>Live Audio Waveform:</h3>
        <canvas id="calibration-canvas"></canvas>

        <div class="chart-container">
            <div class="chart-title">Frequency Spectrum Analysis</div>
            <canvas id="calibration-spectrum" class="spectrum-chart"></canvas>
        </div>

        <div class="chart-container">
            <div class="chart-title">Amplitude History (Last 60 samples)</div>
            <canvas id="calibration-history" class="history-chart"></canvas>
        </div>

        <div id="calibration-placeholder" class="waveform-placeholder" style="display:none;">
            <p style="color: #666; text-align: center; padding: 40px; font-size: 14px;">No audio samples
                captured yet. Start listening to see live data.</p>
        </div>
    </div>
</div>